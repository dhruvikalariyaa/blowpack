{"ast":null,"code":"\"use strict\";\n\n// Copyright 2015 Google LLC\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.UserRefreshClient = exports.USER_REFRESH_ACCOUNT_TYPE = void 0;\nconst oauth2client_1 = require(\"./oauth2client\");\nconst authclient_1 = require(\"./authclient\");\nexports.USER_REFRESH_ACCOUNT_TYPE = 'authorized_user';\nclass UserRefreshClient extends oauth2client_1.OAuth2Client {\n  // TODO: refactor tests to make this private\n  // In a future gts release, the _propertyName rule will be lifted.\n  // This is also a hard one because `this.refreshToken` is a function.\n  _refreshToken;\n  /**\n   * The User Refresh Token client.\n   *\n   * @param optionsOrClientId The User Refresh Token client options. Passing an `clientId` directly is **@DEPRECATED**.\n   * @param clientSecret **@DEPRECATED**. Provide a {@link UserRefreshClientOptions `UserRefreshClientOptions`} object in the first parameter instead.\n   * @param refreshToken **@DEPRECATED**. Provide a {@link UserRefreshClientOptions `UserRefreshClientOptions`} object in the first parameter instead.\n   * @param eagerRefreshThresholdMillis **@DEPRECATED**. Provide a {@link UserRefreshClientOptions `UserRefreshClientOptions`} object in the first parameter instead.\n   * @param forceRefreshOnFailure **@DEPRECATED**. Provide a {@link UserRefreshClientOptions `UserRefreshClientOptions`} object in the first parameter instead.\n   */\n  constructor(optionsOrClientId,\n  /**\n   * @deprecated - provide a {@link UserRefreshClientOptions `UserRefreshClientOptions`} object in the first parameter instead\n   */\n  clientSecret,\n  /**\n   * @deprecated - provide a {@link UserRefreshClientOptions `UserRefreshClientOptions`} object in the first parameter instead\n   */\n  refreshToken,\n  /**\n   * @deprecated - provide a {@link UserRefreshClientOptions `UserRefreshClientOptions`} object in the first parameter instead\n   */\n  eagerRefreshThresholdMillis,\n  /**\n   * @deprecated - provide a {@link UserRefreshClientOptions `UserRefreshClientOptions`} object in the first parameter instead\n   */\n  forceRefreshOnFailure) {\n    const opts = optionsOrClientId && typeof optionsOrClientId === 'object' ? optionsOrClientId : {\n      clientId: optionsOrClientId,\n      clientSecret,\n      refreshToken,\n      eagerRefreshThresholdMillis,\n      forceRefreshOnFailure\n    };\n    super(opts);\n    this._refreshToken = opts.refreshToken;\n    this.credentials.refresh_token = opts.refreshToken;\n  }\n  /**\n   * Refreshes the access token.\n   * @param refreshToken An ignored refreshToken..\n   * @param callback Optional callback.\n   */\n  async refreshTokenNoCache() {\n    return super.refreshTokenNoCache(this._refreshToken);\n  }\n  async fetchIdToken(targetAudience) {\n    const opts = {\n      ...UserRefreshClient.RETRY_CONFIG,\n      url: this.endpoints.oauth2TokenUrl,\n      method: 'POST',\n      data: new URLSearchParams({\n        client_id: this._clientId,\n        client_secret: this._clientSecret,\n        grant_type: 'refresh_token',\n        refresh_token: this._refreshToken,\n        target_audience: targetAudience\n      })\n    };\n    authclient_1.AuthClient.setMethodName(opts, 'fetchIdToken');\n    const res = await this.transporter.request(opts);\n    return res.data.id_token;\n  }\n  /**\n   * Create a UserRefreshClient credentials instance using the given input\n   * options.\n   * @param json The input object.\n   */\n  fromJSON(json) {\n    if (!json) {\n      throw new Error('Must pass in a JSON object containing the user refresh token');\n    }\n    if (json.type !== 'authorized_user') {\n      throw new Error('The incoming JSON object does not have the \"authorized_user\" type');\n    }\n    if (!json.client_id) {\n      throw new Error('The incoming JSON object does not contain a client_id field');\n    }\n    if (!json.client_secret) {\n      throw new Error('The incoming JSON object does not contain a client_secret field');\n    }\n    if (!json.refresh_token) {\n      throw new Error('The incoming JSON object does not contain a refresh_token field');\n    }\n    this._clientId = json.client_id;\n    this._clientSecret = json.client_secret;\n    this._refreshToken = json.refresh_token;\n    this.credentials.refresh_token = json.refresh_token;\n    this.quotaProjectId = json.quota_project_id;\n    this.universeDomain = json.universe_domain || this.universeDomain;\n  }\n  fromStream(inputStream, callback) {\n    if (callback) {\n      this.fromStreamAsync(inputStream).then(() => callback(), callback);\n    } else {\n      return this.fromStreamAsync(inputStream);\n    }\n  }\n  async fromStreamAsync(inputStream) {\n    return new Promise((resolve, reject) => {\n      if (!inputStream) {\n        return reject(new Error('Must pass in a stream containing the user refresh token.'));\n      }\n      let s = '';\n      inputStream.setEncoding('utf8').on('error', reject).on('data', chunk => s += chunk).on('end', () => {\n        try {\n          const data = JSON.parse(s);\n          this.fromJSON(data);\n          return resolve();\n        } catch (err) {\n          return reject(err);\n        }\n      });\n    });\n  }\n  /**\n   * Create a UserRefreshClient credentials instance using the given input\n   * options.\n   * @param json The input object.\n   */\n  static fromJSON(json) {\n    const client = new UserRefreshClient();\n    client.fromJSON(json);\n    return client;\n  }\n}\nexports.UserRefreshClient = UserRefreshClient;","map":{"version":3,"names":["Object","defineProperty","exports","value","UserRefreshClient","USER_REFRESH_ACCOUNT_TYPE","oauth2client_1","require","authclient_1","OAuth2Client","_refreshToken","constructor","optionsOrClientId","clientSecret","refreshToken","eagerRefreshThresholdMillis","forceRefreshOnFailure","opts","clientId","credentials","refresh_token","refreshTokenNoCache","fetchIdToken","targetAudience","RETRY_CONFIG","url","endpoints","oauth2TokenUrl","method","data","URLSearchParams","client_id","_clientId","client_secret","_clientSecret","grant_type","target_audience","AuthClient","setMethodName","res","transporter","request","id_token","fromJSON","json","Error","type","quotaProjectId","quota_project_id","universeDomain","universe_domain","fromStream","inputStream","callback","fromStreamAsync","then","Promise","resolve","reject","s","setEncoding","on","chunk","JSON","parse","err","client"],"sources":["E:/blowpack/frountend/node_modules/google-auth-library/build/src/auth/refreshclient.js"],"sourcesContent":["\"use strict\";\n// Copyright 2015 Google LLC\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.UserRefreshClient = exports.USER_REFRESH_ACCOUNT_TYPE = void 0;\nconst oauth2client_1 = require(\"./oauth2client\");\nconst authclient_1 = require(\"./authclient\");\nexports.USER_REFRESH_ACCOUNT_TYPE = 'authorized_user';\nclass UserRefreshClient extends oauth2client_1.OAuth2Client {\n    // TODO: refactor tests to make this private\n    // In a future gts release, the _propertyName rule will be lifted.\n    // This is also a hard one because `this.refreshToken` is a function.\n    _refreshToken;\n    /**\n     * The User Refresh Token client.\n     *\n     * @param optionsOrClientId The User Refresh Token client options. Passing an `clientId` directly is **@DEPRECATED**.\n     * @param clientSecret **@DEPRECATED**. Provide a {@link UserRefreshClientOptions `UserRefreshClientOptions`} object in the first parameter instead.\n     * @param refreshToken **@DEPRECATED**. Provide a {@link UserRefreshClientOptions `UserRefreshClientOptions`} object in the first parameter instead.\n     * @param eagerRefreshThresholdMillis **@DEPRECATED**. Provide a {@link UserRefreshClientOptions `UserRefreshClientOptions`} object in the first parameter instead.\n     * @param forceRefreshOnFailure **@DEPRECATED**. Provide a {@link UserRefreshClientOptions `UserRefreshClientOptions`} object in the first parameter instead.\n     */\n    constructor(optionsOrClientId, \n    /**\n     * @deprecated - provide a {@link UserRefreshClientOptions `UserRefreshClientOptions`} object in the first parameter instead\n     */\n    clientSecret, \n    /**\n     * @deprecated - provide a {@link UserRefreshClientOptions `UserRefreshClientOptions`} object in the first parameter instead\n     */\n    refreshToken, \n    /**\n     * @deprecated - provide a {@link UserRefreshClientOptions `UserRefreshClientOptions`} object in the first parameter instead\n     */\n    eagerRefreshThresholdMillis, \n    /**\n     * @deprecated - provide a {@link UserRefreshClientOptions `UserRefreshClientOptions`} object in the first parameter instead\n     */\n    forceRefreshOnFailure) {\n        const opts = optionsOrClientId && typeof optionsOrClientId === 'object'\n            ? optionsOrClientId\n            : {\n                clientId: optionsOrClientId,\n                clientSecret,\n                refreshToken,\n                eagerRefreshThresholdMillis,\n                forceRefreshOnFailure,\n            };\n        super(opts);\n        this._refreshToken = opts.refreshToken;\n        this.credentials.refresh_token = opts.refreshToken;\n    }\n    /**\n     * Refreshes the access token.\n     * @param refreshToken An ignored refreshToken..\n     * @param callback Optional callback.\n     */\n    async refreshTokenNoCache() {\n        return super.refreshTokenNoCache(this._refreshToken);\n    }\n    async fetchIdToken(targetAudience) {\n        const opts = {\n            ...UserRefreshClient.RETRY_CONFIG,\n            url: this.endpoints.oauth2TokenUrl,\n            method: 'POST',\n            data: new URLSearchParams({\n                client_id: this._clientId,\n                client_secret: this._clientSecret,\n                grant_type: 'refresh_token',\n                refresh_token: this._refreshToken,\n                target_audience: targetAudience,\n            }),\n        };\n        authclient_1.AuthClient.setMethodName(opts, 'fetchIdToken');\n        const res = await this.transporter.request(opts);\n        return res.data.id_token;\n    }\n    /**\n     * Create a UserRefreshClient credentials instance using the given input\n     * options.\n     * @param json The input object.\n     */\n    fromJSON(json) {\n        if (!json) {\n            throw new Error('Must pass in a JSON object containing the user refresh token');\n        }\n        if (json.type !== 'authorized_user') {\n            throw new Error('The incoming JSON object does not have the \"authorized_user\" type');\n        }\n        if (!json.client_id) {\n            throw new Error('The incoming JSON object does not contain a client_id field');\n        }\n        if (!json.client_secret) {\n            throw new Error('The incoming JSON object does not contain a client_secret field');\n        }\n        if (!json.refresh_token) {\n            throw new Error('The incoming JSON object does not contain a refresh_token field');\n        }\n        this._clientId = json.client_id;\n        this._clientSecret = json.client_secret;\n        this._refreshToken = json.refresh_token;\n        this.credentials.refresh_token = json.refresh_token;\n        this.quotaProjectId = json.quota_project_id;\n        this.universeDomain = json.universe_domain || this.universeDomain;\n    }\n    fromStream(inputStream, callback) {\n        if (callback) {\n            this.fromStreamAsync(inputStream).then(() => callback(), callback);\n        }\n        else {\n            return this.fromStreamAsync(inputStream);\n        }\n    }\n    async fromStreamAsync(inputStream) {\n        return new Promise((resolve, reject) => {\n            if (!inputStream) {\n                return reject(new Error('Must pass in a stream containing the user refresh token.'));\n            }\n            let s = '';\n            inputStream\n                .setEncoding('utf8')\n                .on('error', reject)\n                .on('data', chunk => (s += chunk))\n                .on('end', () => {\n                try {\n                    const data = JSON.parse(s);\n                    this.fromJSON(data);\n                    return resolve();\n                }\n                catch (err) {\n                    return reject(err);\n                }\n            });\n        });\n    }\n    /**\n     * Create a UserRefreshClient credentials instance using the given input\n     * options.\n     * @param json The input object.\n     */\n    static fromJSON(json) {\n        const client = new UserRefreshClient();\n        client.fromJSON(json);\n        return client;\n    }\n}\nexports.UserRefreshClient = UserRefreshClient;\n//# sourceMappingURL=refreshclient.js.map"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}